# SimAlign Word Alignment Generator

Dieses Script verwendet SimAlign zur Generierung von Wort-Alignments zwischen deutschen und englischen Sätzen.

## Installation

```bash
pip install -r requirements.txt
```

## Verwendung

### Grundlegende Verwendung

```bash
python get_simalign_alignments.py -s input_de.txt -t input_en.txt -o alignments.txt
```

### Erweiterte Verwendung mit allen Parametern

```bash
python get_simalign_alignments.py \
    --source_file ../../Corpus/TEST_DATA/TEST_DATA.de \
    --target_file ../../Corpus/TEST_DATA/TEST_DATA.en \
    --output_file simalign_alignments.txt \
    --model_name bert-base-multilingual-cased \
    --matching_methods mai \
    --token_type word \
    --distortion 0.0 \
    --max_lines 1000 \
    --verbose
```

## Parameter-Dokumentation für wissenschaftliche Zwecke

### Modell-Parameter

#### `--model_name` / `-m`

- **Standard:** `bert-base-multilingual-cased`
- **Beschreibung:** Das zugrundeliegende Transformer-Modell für die Generierung von Wort-Embeddings
- **Empfohlene Modelle für DE-EN:**
  - `bert-base-multilingual-cased`: Allzweck-Modell, gut für die meisten Sprachen
  - `xlm-roberta-base`: Oft bessere Performance bei mehrsprachigen Aufgaben
  - `distilbert-base-multilingual-cased`: Schnellere, aber weniger genaue Variante
- **Wissenschaftliche Relevanz:** Die Wahl des Modells beeinflusst die Qualität der Embeddings und damit die Alignment-Qualität erheblich

#### `--matching_methods`

- **Standard:** `mai` (alle Methoden)
- **Beschreibung:** Bestimmt die verwendeten Alignment-Matching-Strategien
- **Optionen:**
  - `m` (max): Maximum-basiertes Matching
  - `a` (argmax): Argmax-basiertes Matching (auch als MWMF - Max Weight Matching Forward bekannt)
  - `i` (inter): Intersection-basiertes Matching (konservativste Methode)
- **Wissenschaftliche Relevanz:**
  - `inter` produziert hochpräzise, aber weniger vollständige Alignments
  - `max` und `argmax` sind vollständiger, aber möglicherweise weniger präzise
  - Kombination aller Methoden ermöglicht Vergleichsstudien

#### `--token_type`

- **Standard:** `word`
- **Beschreibung:** Bestimmt die Granularität der Tokenisierung
- **Optionen:**
  - `word`: Wort-Level-Tokenisierung (empfohlen für die meisten Anwendungen)
  - `bpe`: Subword-/BPE-Level-Tokenisierung (für feinere Alignments)
- **Wissenschaftliche Relevanz:**
  - Word-Level eignet sich für linguistische Analysen
  - BPE-Level kann bei morphologisch reichen Sprachen bessere Ergebnisse liefern

#### `--distortion`

- **Standard:** `0.0`
- **Beschreibung:** Gewichtung für strukturelle/positionelle Ähnlichkeit zusätzlich zu semantischer Ähnlichkeit
- **Bereich:** 0.0 bis 1.0
- **Wissenschaftliche Relevanz:**
  - 0.0 = nur semantische Ähnlichkeit
  - Höhere Werte berücksichtigen auch die Position der Wörter im Satz
  - Kann bei strukturell ähnlichen Sprachen die Alignment-Qualität verbessern

### Eingabe-/Ausgabe-Parameter

#### `--source_file` / `-s`

- **Standard:** `../../Corpus/TEST_DATA/TEST_DATA.de`
- **Beschreibung:** Pfad zur deutschen Quelldatei (ein Satz pro Zeile)

#### `--target_file` / `-t`

- **Standard:** `../../Corpus/TEST_DATA/TEST_DATA.en`
- **Beschreibung:** Pfad zur englischen Zieldatei (ein Satz pro Zeile)

#### `--output_file` / `-o`

- **Standard:** `simalign_alignments.txt`
- **Beschreibung:** Ausgabedatei im Pharaoh-Format
- **Format:** `source_index-target_index` (0-basiert), z.B. `0-0 1-2 3-1`

### Verarbeitungsparameter

#### `--max_lines`

- **Standard:** `None` (alle Zeilen)
- **Beschreibung:** Begrenzt die Anzahl der zu verarbeitenden Satzpaare (nützlich für Tests)

#### `--verbose` / `-v`

- **Standard:** `False`
- **Beschreibung:** Aktiviert detaillierte Logging-Ausgaben

## Ausgabeformat

Die Ausgabedatei enthält:

1. Header mit allen verwendeten Parametern (für Reproduzierbarkeit)
2. Eine Zeile pro Satzpaar mit Alignments im Pharaoh-Format
3. Leere Zeilen für Sätze ohne Alignments
4. Fehlermarkierungen für problematische Sätze

### Beispiel-Ausgabe:

```
# Word alignments generated by SimAlign
# Model: bert-base-multilingual-cased
# Matching methods: mai
# Token type: word
# Distortion: 0.0
# Format: source_word_index-target_word_index (0-indexed)
# Each line corresponds to one sentence pair

0-0 1-1 2-3 3-2
1-0 2-1 3-2
# ERROR IN THIS LINE
```

## Wissenschaftliche Verwendung

### Empfohlene Parameter-Kombinationen für verschiedene Studien:

1. **Hochpräzise Alignments (für Goldstandard-Vergleiche):**

   ```bash
   --matching_methods i --token_type word --distortion 0.0
   ```

2. **Vollständige Alignments (für maschinelle Übersetzung):**

   ```bash
   --matching_methods ma --token_type word --distortion 0.1
   ```

3. **Subword-Analyse:**
   ```bash
   --matching_methods mai --token_type bpe --distortion 0.0
   ```

### Evaluation und Metriken

Für wissenschaftliche Evaluationen sollten die generierten Alignments mit Standard-Metriken wie AER (Alignment Error Rate) gegen Goldstandard-Alignments verglichen werden.

## Technische Details

- **Speicherbedarf:** Abhängig vom gewählten Modell (BERT: ~500MB, XLM-R: ~1GB)
- **GPU-Unterstützung:** Automatische Erkennung und Verwendung verfügbarer GPUs
- **Batch-Verarbeitung:** Satz-für-Satz-Verarbeitung mit Fortschrittsanzeige
- **Fehlerbehandlung:** Robuste Behandlung von problematischen Eingaben
